#!/bin/sh
#Produit toute les question lors de l'installation du paquet
#Les réponses peuvent être utilisé dans les scripts postinst
#, preinst, postrm, prerm

set -e
#set -x

# Source debconf library.
. /usr/share/debconf/confmodule

#get information about db of obm-conf
#db_get obm-conf/dbtype
#FUNAMBOL_DBTYPE=$RET
#db_get obm-conf/dbhost
#FUNAMBOL_HOST=$RET
#db_get obm-conf/dbname
#FUNAMBOL_DB=$RET
#db_get obm-conf/dbuser
#FUNAMBOL_USER=$RET
#db_get obm-conf/dbpasswd
#FUNAMBOL_PASSWD=$RET


#create db and dbuser of OBM 
#if [ -f /usr/share/dbconfig-common/dpkg/config ]; then
  #dbc_hardcoded_dbtype="mysql"
  #Bug in dbconfig-common 1.8.39 about dbc_dbpass and multidb
  #I can't use dbc_dbtypes
#  if  [ ${FUNAMBOL_DBTYPE} = "MYSQL" ] ; then
#    dbc_hardcoded_dbtype="mysql"
#  elif  [ ${FUNAMBOL_DBTYPE} = "PGSQL" ] ; then
#    dbc_hardcoded_dbtype="pgsql"
#  fi
#  dbc_authmethod_user="password"
#  dbc_dbserver="${FUNAMBOL_HOST}"
#  dbc_dbname="${FUNAMBOL_DB}"
#  dbc_dbuser="${FUNAMBOL_USER}"
#  dbc_dbpass="${FUNAMBOL_PASSWD}"
#  . /usr/share/dbconfig-common/dpkg/config
#  dbc_go obm-funambol-storage $@
#fi


#test si dbconfig-common est deja configurer ou pas
if [ -f /usr/share/dbconfig-common/dpkg/config.pgsql ]; then
  #creation de la BD et User OBM 
  if [ -f /usr/share/dbconfig-common/dpkg/config.pgsql ]; then
     . /usr/share/dbconfig-common/dpkg/config.pgsql
     dbc_dbname="obmfunambol"
     dbc_dbuser="obmfunambol"
     dbc_go obm-funambol-storage $@
  fi
fi

exit 0


