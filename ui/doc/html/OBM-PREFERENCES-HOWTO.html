<HTML>
<HEAD>
<TITLE>OBM-PREFERENCES-HOWTO</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<CENTER>

<H1>OBM-PREFERENCES-HOWTO</H1>
<I>Comment utiliser les preferences utilisateur </I><BR>
Version 0.5 - 2002-08-27<BR>
</CENTER>


<H2>La table UserObmPref</h2>
<p>

<table border=1>
<tr>
<td><b>champ</b></td><td><b>type</b></td><td><b>role</b></td>
</tr>
<tr>
<td>userobmpref_id</td><td>int(8)</td><td>identifiant de l'utilisateur</td>
</tr>
<tr>
<td>userobmpref_option</td><td>varchar(50)</td><tD>nom de l'option</td> 
</tr>
<tr>
<td>userobmpref_value</td><td>varchar(50)</td><td>valeur de l'option</td>
</tr>
</table>
<br><br>

<H2>Les options deja existantes</h2>
<p>

<table border=1>
<tr>
<td><b>option</b></td><td><b>role</b></td><td><b>valeurs possibles</b></td>
</tr>
<tr>
<td>set_lang</td><td>derniere langue utilisee</td><td>"fr", "de", "no-ny", "en" ... </td>
</tr>
<tr>
<td>set_theme</td><td>dernier theme d'obm utilise</td><tD>"standard", "lmm2" ...</td> 
</tr>
<tr>
<td>set_rows</td><td>nombre de lignes affichees dans les listes</td><td>&nbsp;</td>
</tr>
<tr>
<td>set_display</td><td>etat de l'affichage des listes : automatique ou non</td><td>"yes" ou "no"</td>
</tr>
<tr>
<td>set_debug</td><td>niveau de debug</td><td>0, 1, 2, ou 5 </td>
</tr>
<tr>
<td>last_company</td><td>identifiant de la derniere societe consultee</td><td>&nbsp;</td>
</tr>
<tr>
<td>last_contact</td><td>identifiant du dernier contact consulte</td><td>&nbsp;</td>
</tr>
<tr>
<td>last_deal</td><td>identifiant de la derniere affaire consultee</td><td>&nbsp;</td>
</tr>
</table>

<br>
<p><b>Remarque 1 :</b> les variables de session correspondant aux preferences de l'utilisateur sont crées automatiquement lors de la connection a obm, et elles ont le meme nom que les options.<i>Ex: $set_theme correspond a l'option "set_theme"</i>.
<p>

<br>


<h2>Ajout de nouvelles options</h2>
<p>Voila la marche a suivre lors de l'utilisation d'une nouvelle option :</p>

<UL>

<LI>L'integrer au profil par default insere dans UserObmPref a la creation d'un nouvel utilisateur (fonction <i>run_query_default_preferences_insert($user_id)</i> dans <b>/user/user_query.inc</b>).<br>
Pas besoin de prevoir sa suppression puisque a la disparition d'un utilisateur, on efface tous les tuples le concernant dans UserObmPref.
<br><br>
<LI>Si cette option est parametrable par l'utilisateur (comme la langue, le theme ...) il faut prevoir son formulaire de modification dans le module "Settings". La mise a jour en base de donnees se fait par le biais de la fonction <i>run_query_set_user_pref($auth, $userobmpref_option,$new_value)</i> de <b>obminclude/query_global.inc</b>.(remarque : si on est dans "Settings" la mise a jour se fait dans setting_index.php).

</UL>

<p><b>Remarque :</b>
La mise en variables de session des preferences se fait automatiquement, et ces variables ont le meme nom que les options auxquelles elles correspondent.
<p>

<br>

</BODY>
</HTML>