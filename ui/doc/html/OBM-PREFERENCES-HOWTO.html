<html>
<head>
<title>OBM-PREFERENCES-HOWTO</title>
</head>

<body bgcolor="#FFFFFF">

<a href="javascript:back();">back</a>

<center>

<h1>OBM-PREFERENCES-HOWTO</h1>
<I>Comment utiliser les préférences utilisateur </I><BR>
Version 0.6.6 - 2003-07-14<BR>
</CENTER>


<h2>La table UserObmPref</h2>
<p>

<table border=1>
<tr>
<td><b>champ</b></td><td><b>type</b></td><td><b>role</b></td>
</tr>
<tr>
<td>userobmpref_id</td><td>int(8)</td><td>identifiant de l'utilisateur</td>
</tr>
<tr>
<td>userobmpref_option</td><td>varchar(50)</td><tD>nom de l'option</td> 
</tr>
<tr>
<td>userobmpref_value</td><td>varchar(50)</td><td>valeur de l'option</td>
</tr>
</table>
<br>


<h2>Les préférences par défaut</h2>

Les entrées pour l'utilisateur 0 (userobmpref_id=0) correspondent aux préférences par défaut.

Les préférences par défaut servent à :

<ul>
  <li>Initialiser les préférences d'un utilisateur lors de sa création.
  <li>Remettre à jour les préférences d'un ou tous les utilisateurs (utile par exemple pour la propagation d'une nouvelle préférence).
Ceci s'effectue dans l'écran de l'utilisateur (pour portée sur l'utilisateur) ou dans l'administration des préférences (pour portée sur l'ensemble des utilisateurs).
</ul>


<H2>Les options déjà existantes</h2>
<p>

<table border=1>
<tr>
  <th>option</th>
  <th>role</th>
  <th>valeurs possibles</th>
</tr><tr>
  <td>set_lang</td>
  <td>langue utilisée</td>
  <td>"fr", "en", "it", "de", "no-ny",...</td>
</tr><tr>
  <td>set_theme</td>
  <td>thème utilisé</td>
  <td>"standard", "aliacom", "lmm2" ...</td> 
</tr><tr>
  <td>set_rows</td>
  <td>nombre de lignes affichées dans les listes</td>
  <td>&nbsp;</td>
</tr><tr>
  <td>set_display</td>
  <td>état de l'affichage des listes : automatique ou non</td>
  <td>"yes" ou "no"</td>
</tr><tr>
  <td>set_menu</td>
  <td>Affichage des menus (texte ou icone)</td>
  <td>($cme_txt || $cme_ico || $cme_both)</td>
</tr><tr>
  <td>set_date</td>
  <td>format de date pour affichage</td>
  <td>($cda_iso || $cda_fr || $cda_en || $cda_txt)</td>
</tr><tr>
  <td>set_commentorder</td>
  <td>Ordre d'affichage des commentaires</td>
  <td>($cco_chro || $cco_rev)</td>
</tr><tr>
  <td>set_debug</td>
  <td>niveau de debug</td>
  <td>combinaison des flags de debug (dbg_sql, dbg_exe,...)</td>
</tr><tr>
  <td>last_company</td>
  <td>identifiant de la dernière société consultée</td>
  <td>&nbsp;</td>
</tr><tr>
  <td>last_contact</td>
  <td>identifiant du dernier contact consulté</td>
  <td>&nbsp;</td>
</tr><tr>
  <td>last_deal</td>
  <td>identifiant de la dernière affaire consultée</td>
  <td>&nbsp;</td>
</tr>
</table>


<h2>Ajout de nouvelles options</h2>
<p>Voila la marche a suivre lors de l'utilisation d'une nouvelle option :</p>

<ul>
  <li>L'intégrer aux préférences par défault. Ajouter dans <i>scripts/$version/obmdb_default_values.sql</i> l'insertion de l'option pour l'utilisateur 0. Lors de l'insertion d'un nouvel utilisateur les préférences par défaut lui sont associées (fonction <i>run_query_default_preferences_insert($user_id)</i> dans <b>global_query.inc</b>).
<br>
Pas besoin de prevoir sa suppression puisque a la disparition d'un utilisateur, on efface tous les tuples le concernant dans UserObmPref.
<br><br>
  <li>Si cette option est parametrable par l'utilisateur (comme la langue, le theme ...) il faut prevoir son formulaire de modification dans le module "Settings". La mise a jour en base de donnees se fait par le biais de la fonction <i>run_query_set_user_pref($user_id, $option, $value)</i> de <b>obminclude/query_global.inc</b>, et sa valeur par defaut dans <b>global_pref.inc</b>.
</ul>


<h2>Création des variables de session liées aux préférences</h2>

La mise en variables de session des préférences se fait automatiquement, et ces variables ont le même nom que les options auxquelles elles correspondent.
<p>

Ceci se produit :
<ul>
  <li> A la connexion a OBM, toutes les préférences sont chargées.
C'est la fonction <i>session_load_user_prefs</i> (dans global_query.inc) qui effectue ce travail.
  <li> Lors du choix d'une option (langue, thème,...), cette option est sauvegardée dans les préférences (module settings appelle la fonction <i>run_query_set_user_pref($user_id, $option, $value) de global_query.inc pour l'option choisie).
</ul>

<br /><br />
<a href="javascript:back();">back</a>

</body>
</html>