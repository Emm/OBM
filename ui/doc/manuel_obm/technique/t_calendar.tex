% Documentation technique d'OBM : module Calendar
% ALIACOM Medhi Rande
% $Id:

\section{Calendar}

Le \calendar \obm  est un agenda partagé permettant d'inserer, modifier, consulter ou supprimer des évenements pour un ou plusieurs utilisateurs simultané.

\clearpage

\subsection{Organisation de la base de données}

Le \calendar utilise trois tables :
\begin{itemize}
 \item CalendarCategory
 \item CalendarEvent
 \item CalendarSegment
\end{itemize}

\subsubsection{CalendarCategory}
Cette table est utilisée pour sotcker les catégories des événements.
\begin{description}
 \item[calendarcategory\_id] int(8) : C'est la clé primaire de la table.
 \item[calendarcategory\_timeupdate] timestamp(14) : Donne au format Unix la date de dernière mise à jour du tuple.
 \item[calendarcategory\_timecreate] timestamp(14) : Donne au format Unix la date de création du tuple.
 \item[calendarcategory\_userupdate] int(8) : Id de l'utilisateur qui à opéré la dernière mise à jour.
 \item[calendarcategory\_usercreate] int(8) : Id de l'utilisateur qui à créé le tuple.
 \item[calendarcategory\_label] varchar(128) : Label de la catégorie. 
\end{description}

\subsubsection{CalendarEvent}
Cette table stocke toute la description d'un évenement ainsi que ces caractéristiques.
\begin{description}
 \item[calendarevent\_id] int(8) : C'est la clé primaire de la table.
 \item[calendarevent\_timeupdate] timestamp(14) : Donne au format Unix la date de dernière mise à jour du tuple.
 \item[calendarevent\_timecreate] timestamp(14) : Donne au format Unix la date de création du tuple.
 \item[calendarevent\_userupdate] int(8) : Id de l'utilisateur qui à opéré la dernière mise à jour.
 \item[calendarevent\_usercreate] int(8) : Id de l'utilisateur qui à créé le tuple.
 \item[calendarevent\_title] varchar(255) : Titre de l'évenement(description courte).
 \item[calendarevent\_description] text  : Description de l'événement
 \item[calendarevent\_category\_id] int(8) : Clé étrangère pointant vers CalendarCategory indiquant la catégorie de l'évenement.
 \item[calendarevent\_priority] int(2) : Priotité de l'événement. Les differentes valeurs possibles sont <1> pour Basse, <2> pour Normal, <3> pour Haute.
 \item[calendarevent\_privacy] int(2) : Indique si l'événement est un événement privé ou non. Un événement privé ne peux pas etre vue en vue multi-utilisateurs.
 \item[calendarevent\_length] varchar(14)  : Durée de l'événement en seconde.
 \item[calendarevent\_repeatkind] varchar(20) : Type de répétition de l'évenement. Les differentes valeurs sont <none> pour indiquer l'absence de répétition, <weekly> pour indiquer une répétion qui aurait lieu toute les semaines, <monthlybydate> pour une répétion qui aurait lieu tout les mois a une date donné (le 4 de chaque mois par exemple), <monthlybyday> pour une répétition qui aurait lieu tout les mois à un jour donné(exemple tout les seconds lundi du mois) et enfin <yearly> pour une répétition annuelle.
 \item[calendarevent\_repeatdays] varchar(7) : Pour le cas d'une répétition hébdomadaire, ce champs determine les jours de la semaine auxquels ont lieu l'évenement. La valeur de ce champ est composée de 7 valeurs binaire(une pour chaque jour de la semaine). Un 1 signifira que le jour en question l'évenement aura lieu, le 0 que non (exemple : si la semaine commence Lundi : 1100100 signifiera que l'évenement a lieu les lundi, mardi, et vendredi).
 \item calendarevent\_endrepeat varchar(12) : Date de fin de répétition.
\end{description}

\subsubsection{CalendarEvent}
Cette table stocke toutes les occurrences d'un événement.
\begin{description}
 \item[calendarsegment\_eventid] int(8) : C'est la clé primaire de la table.
 \item[calendarsegment\_customerid] int(8) : Clé étrangère pointant vers UserObm ou vers la table de groupe(non implémenté actuellement) indiquant l'utilisateur ou le groupe concerné par cette occurrence de l'évenement.
 \item[calendarsegment\_date] varchar(12) : Date de l'occurence.
 \item[calendarsegment\_flag] varchar(5) : Ce champ permet de determiner si la date est la date de debut ou de fin de l'occurence. Ainsi chaque occurence aura deux tuples dans cette table, un possedant le flag <Begin>(début), l'autre le flag <End>(fin).
 \item[calendarsegment\_type] varchar(5) : Determine si l'occurence affect un groupe (<group>) ou un utilisateur(<user>).
 \item[calendarsegment\_state] char(1) : Etat de l'occurence, ce champ peux prendre trois valeurs, <R> pour Refusé, <W> pour en attente, et <A> pour accepté.
\end{description} 

\clearpage


\subsection{Actions, droits, et fonctions}
Dans cette section seront listées et décrites les actions du module, ainsi que les droits qui leurs sont appliqués et l'intitulé des fonctions executées. 

\subsubsection{Actions}

Voici la liste des action du modul \calendar, ainsi qu'une description sommaire de chacune d'entre elles.\\
\begin{tabular}{|c|p{9cm}|}
 \hline
 \textbf{Intitulé} & \textbf{Description} \\
 \hline
 \hline
 <index> & Action par défaut, elle affiche suivant le cas le formulaire présentant les évenements en attente ou le planning de la semaine en cours pour l'utilisateur courant. \\ 
 \hline
 <decision> & Cette action modify l'état de l'occurence d'un évenement en fonction du choix de l'utilisateur sur le formulaire présentant les évenements en attente. \\ 
 \hline
  <view\_year> & Insere un événement suite à l'affichage du formulaire du gestion de conflit. \\ 
 \hline
  <view\_month> & Affiche le planning au format du mois. \\
 \hline
  <view\_week> & Affiche le planning au format de la semaine. \\
 \hline
  <view\_day> & Affiche le planning au format du jour. \\ 
 \hline
 <new> & Cette action affiche le formulaire d'ajout d'un nouvel évenement. \\
 \hline
 <insert> & Cette action suivant les cas insére un événement saisie par l'utilisateur, annule l'insertion et ré-affiche le formulaire d'ajout d'événement en cas d'erreur, ou affiche le forumaire de gestion de conflit.  \\ 
 \hline
 <insert\_conflict> & Insere un événement suite à l'affichage du formulaire du gestion de conflit. \\ 
 \hline
  <detail\_consult> & Affiche les détails d'un événement ainsi que le forumulaire de changement de décision. \\
 \hline
  <check\_delete> & Affiche le formulaire de confiramtion de suppression. \\
 \hline
  <delete> & Supprime un évenement ainsi que toutes ses occurrences. \\
 \hline
  <detailupdate> & Affiche le formulaire de mise à jour des détails d'un évenements. \\
 \hline
  <update> & Suivant les cas met à jour un événement et eventuellement ses occurences, annule la mise à jour et ré-affiche le formulaire de mise à jour d'événement en cas d'erreur. \\
 \hline
  <update\_decision> & Mise à jour de l'etat d'une occurence suite à un changement de l'utilisateur sur le forumulaire de changement de décision. \\
 \hline
\end{tabular}

\clearpage

\subsubsection{Droits}

Ci-dessous le tableau présentant les droits necessaires à l'execution de chaque action ainsi que l'intitulé de ce droit. \\
\begin{tabular}{|c|c|l|}
 \hline
 \textbf{Action} & \textbf{Code du droit} & \textbf{Intitulé du droit}\\
 \hline
 \hline
  <index> & agenda\_read & Droits d'Utilisateur en lecture. \\ 
 \hline
 <decision> & agenda\_write & Droits d'Utilisateur en ecriture. \\ 
 \hline
  <view\_year> & agenda\_read & Droits d'Utilisateur en lecture. \\ 
 \hline
  <view\_month> & agenda\_read & Droits d'Utilisateur en lecture. \\
 \hline
  <view\_week> & agenda\_read & Droits d'Utilisateur en lecture. \\
 \hline
 <new> & agenda\_write & Droits d'Utilisateur en ecriture. \\
 \hline
 <insert> & agenda\_write & Droits d'Utilisateur en ecriture. \\ 
 \hline
 <insert\_conflict> & agenda\_write & Droits d'Utilisateur en ecriture. \\ 
 \hline
  <view\_day> & agenda\_read & Droits d'Utilisateur en lecture. \\ 
 \hline
  <detail\_consult> & agenda\_read & Droits d'Utilisateur en lecture. \\
 \hline
  <check\_delete> & agenda\_admin\_write & Droits d'Administrateur en ecriture. \\
 \hline
  <delete> & agenda\_admin\_write & Droits d'Administrateur en ecriture. \\
 \hline
  <detailupdate> &  agenda\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <update> & agenda\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <update\_decision> & agenda\_write & Droits d'Utilisateur en ecriture. \\
 \hline
\end{tabular}
\subsubsection{Fonctions}
 Ci-dessous le tableau présentant la ou les fonctions appelées pour chacune des actions. \\
\begin{tabular}{|c|c|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)}\\
 \hline
 \hline
  <index> & run\_query\_waiting\_events() \\
          & display\_warn\_msg() \\  
          & html\_waiting\_events() \\ 
          & ou \\ 
 	  & run\_query\_waiting\_events() \\
	  & run\_query\_week\_event\_list() \\
	  & run\_query\_get\_user\_name() \\
	  & run\_query\_userobm() \\
	  & dis\_week\_planning() \\
	  & localizeDate() \\
	  & store\_users() \\
	  & store\_events() \\
	  & html\_planning\_bar() \\
 \hline
  <decision> & run\_query\_insert\_decision() \\ 
             & display\_ok\_msg \\
   	     & run\_query\_waiting\_events() \\
  	     & run\_query\_week\_event\_list() \\
	     & run\_query\_get\_user\_name() \\
	     & run\_query\_userobm() \\
	     & dis\_week\_planning() \\
	     & localizeDate() \\
	     & store\_users() \\
	     & store\_events() \\
	     & html\_planning\_bar() \\
	     & ou \\
	     & display\_warn\_msg() \\
	     & html\_dis\_conflict() \\
 \hline
  <view\_year> & run\_query\_year\_event\_list() \\
 	       & run\_query\_get\_user\_name() \\
	       & run\_query\_userobm() \\
	       & dis\_year\_planning() \\
	       & localizeDate() \\
	       & store\_users() \\
	       & store\_daily\_events() \\
	       & html\_planning\_bar() \\
 \hline
  <view\_month> & run\_query\_month\_event\_list() \\
 	        & run\_query\_get\_user\_name() \\
	        & run\_query\_userobm() \\
	        & dis\_month\_planning() \\
	        & localizeDate() \\
	        & store\_users() \\
	        & store\_daily\_events() \\
	        & html\_planning\_bar() \\
 \hline
 \end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline
  <view\_week> & run\_query\_week\_event\_list() \\
	       & run\_query\_get\_user\_name() \\
	       & run\_query\_userobm() \\
	       & dis\_week\_planning() \\
	       & localizeDate() \\
	       & store\_users() \\
	       & store\_events() \\
	       & html\_planning\_bar() \\   	    
 \hline
  <view\_day> & run\_query\_day\_event\_list() \\ 
	      & run\_query\_get\_user\_name() \\
	      & run\_query\_userobm() \\
	      & dis\_day\_planning() \\
	      & localizeDate() \\
	      & store\_users() \\
	      & store\_events() \\
	      & html\_planning\_bar() \\  
 \hline
 <insert> & check\_data\_form() \\ 
          & run\_query\_week\_event\_list() \\
          & run\_query\_get\_user\_name() \\
          & run\_query\_userobm() \\
          & display\_ok\_msg() \\
          & dis\_week\_planning() \\
	  & localizeDate() \\
	  & store\_users() \\
	  & store\_events() \\
	  & html\_planning\_bar() \\
	  & ou \\	  
	  & check\_data\_form() \\ 
          & display\_warn\_msg() \\
          & html\_dis\_conflict() \\
	  & ou \\	
	  & check\_data\_form() \\ 
          & display\_err\_msg() \\
	  & run\_query\_userobm() \\
          & run\_query\_get\_eventcategories() \\
          & run\_query\_userobm() \\
          & dis\_event\_form() \\
	  & ou \\	
	  & check\_data\_form() \\ 
          & display\_warn\_msg() \\
	  & run\_query\_userobm() \\
          & run\_query\_get\_eventcategories() \\
          & run\_query\_userobm() \\
          & dis\_event\_form() \\

 \hline
\end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline
 <insert\_conflict> & run\_query\_manage\_conflict()\\ 
                    & run\_query\_week\_event\_list() \\
                    & run\_query\_get\_user\_name() \\
                    & run\_query\_userobm() \\
                    & display\_ok\_msg() \\
                    & dis\_week\_planning() \\
            	    & localizeDate() \\
	            & store\_users() \\
	            & store\_events() \\
	            & html\_planning\_bar() \\
 \hline 
 <new> & run\_query\_userobm() \\
       & run\_query\_get\_eventcategories() \\
       & run\_query\_userobm() \\
       & dis\_event\_form() \\
 \hline
  <detail\_consult> & run\_query\_detail() \\
  		    & run\_query\_event\_customers() \\
		    & display\_record\_info() \\
		    & html\_calendar\_consult() \\
 \hline
  <check\_delete> & html\_dis\_delete() \\
 \hline
  <delete>  & run\_query\_delete() \\
  	    & run\_query\_waiting\_events() \\
	    & run\_query\_week\_event\_list() \\
	    & run\_query\_get\_user\_name() \\
	    & run\_query\_userobm() \\
	    & dis\_week\_planning() \\
	    & localizeDate() \\
	    & store\_users() \\
	    & store\_events() \\
	    & html\_planning\_bar() \\
 \hline
  <detailupdate> & run\_query\_userobm() \\
  		 & run\_query\_get\_eventcategories() \\
  		 & run\_query\_detail() \\
  		 & run\_query\_event\_customers\_array() \\
  		 & display\_record\_info() \\
  		 & dis\_event\_form() \\
 \hline
\end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline
  <update> & check\_data\_form() \\
           & run\_query\_modify\_event() \\
           & display\_ok\_msg \\
           & run\_query\_week\_event\_list() \\
           & run\_query\_get\_user\_name() \\
           & run\_query\_userobm() \\
           & display\_ok\_msg() \\
           & dis\_week\_planning() \\
           & localizeDate() \\
	   & store\_users() \\
	   & store\_events() \\
	   & html\_planning\_bar() \\
           & ou \\
           & check\_data\_form() \\
           & run\_query\_modify\_event() \\
           & display\_warn\_msg( \\
           & html\_dis\_conflict() \\
           & ou \\
	   & check\_data\_form() \\
	   & run\_query\_modify\_event() \\
           & display\_error\_msg() \\
           & html\_dis\_conflict() \\
           & run\_query\_week\_event\_list() \\
           & run\_query\_get\_user\_name() \\
           & run\_query\_userobm() \\
           & display\_ok\_msg() \\
           & dis\_week\_planning() \\
           & localizeDate() \\
	   & store\_users() \\
	   & store\_events() \\
	   & html\_planning\_bar() \\	   
           & ou \\
	   & check\_data\_form() \\
           & display\_warn\_msg() \\
           & run\_query\_userobm() \\
           & run\_query\_get\_eventcategories() \\
           & dis\_event\_form() \\
 \hline
\end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline 
  <update\_decision> & run\_query\_change\_decision() \\
                     & display\_ok\_msg \\
                     & run\_query\_week\_event\_list() \\
                     & run\_query\_get\_user\_name() \\
                     & run\_query\_userobm() \\
                     & display\_ok\_msg() \\
                     & dis\_week\_planning() \\
            	     & localizeDate() \\
	             & store\_users() \\
	             & store\_events() \\
	             & html\_planning\_bar() \\
		     & ou \\
		     & run\_query\_change\_decision() \\
		     & display\_warn\_msg() \\
		     & html\_dis\_conflict() \\
 \hline
\end{tabular}
\subsection{Fonctionalité}
 Dans cette partie seront abordées les fonctionnalités du module \calendar. Ces fonctionnalités seront étudiés d'un point de vue technique et non utilisateur. Il va donc plus etre sujet du fonctionnement que de l'utilité et de l'utilisation du module.

\subsubsection{Affichage}
 Nous passerons assez rapidement sur l'affichage des details d'un évenement qui est une fonctionnalité assez basique(recherche des éléments en base, puis affichage de ces derniers de manière structuré).
 Nous nous interresseront plus au differentes vues du planning.

 Nous alons dans un premier temps traiter les vues quotidiennes et hebdomadaire.
 Ces deux vues seront traités ensemble car leurs fonctionnements est assez similaires. Nous épiloguerons sur les vues mensuelles et annuelles qui divergent légérement ces deux vues.
 Les etapes de la production de cette affichage sont les suivantes : 
 \begin{itemize}
  \item{Récupération des informations en base de données}
  \item{Traitement des données et construction du modèle}
  \item{Traitement du modèle et construction de la vue}
  \item{Affichage de la vue}
 \end{itemize}
 Donc pour la récupération des données en base, trois fonctions sont utilisées à savoir :
 \begin{description}
  \item{\fonction{run\_query\_(day ou week)\_event\_list}} : Cette fonction permet de récupérer les données propres aux évenements(description, titre... mais aussi les dates) ayant lieu le jour ou la semaine passé en paramètre et concernant les utilisateurs passés en paramètre.
  \item{\fonction{run\_query\_get\_user\_name}} : Cette fonction récupére en base de données les noms des utilisateurs dont les id sont passé en paramètre.
  \item{\fonction{run\_query\_userobm}} : Cette fonction récupére l'ensemble des utilisateurs d'\obm(utilisé pour la constitution de la planning bar).
 \end{description}
 Une fois les données récupérées, elles sont donc traités afin de constituer le modèle.
 En premier lieu les informations sur les utilisateurs récupérés par la fonction \fonction{run\_query\_get\_user\_name} sont stockées dans un tableau,\variable{calendar\_user}, ou chaque utilisateur est associé à une couleur et a une classe \css et une à une image, et ce dans la fonction \fonction{store\_users}.
 Ensuite est constitué le modèle. Celui-ci est construit dans la fonction \fonction{store\_events}. Cette fonction renvoit deux tableaux, le premier,\variable{event\_data}, indexé sur les id des evenements, stocke l'ensemble des données relative a un evenement ainsi que le nombre total de ces occurences sur le jour ou la semaine. Le second,\variable{current\_events}, est un tableau indéxé sur le temps, contient pour chaque unité de temps(l'unité de temps est definit dans le fichier \fichier{global.inc}) la ou les id des evenements ayant lieu à ce moment là.
 \\\textbf{Exemple:}\\
 Prenons la vue quotidienne pour les utilisateurs U1 et U2.
 Voici la liste des évenements de ces deux utilisateur pour le jour J1 :\\
 \begin{tabular}{|c|c|c|c|}
  \hline
   \textbf{Evenements} & \textbf{Heures} & \textbf{U1} & \textbf{U2} \\
  \hline
  \hline
   E1 & H1->H3 & X & \\
   E2 & H2->H4 & & X \\
   E3 & H6->H7 & X & X \\
   E4 & H3->H4 & X &  \\
  \hline
 \end{tabular}  
\\Donc le tableau de données sera de la forme :\\
 \begin{tabular}{|c|c|c|}
  \hline
   \textbf{Id} & \textbf{Information} & \textbf{Occurence} \\
  \hline
  \hline
   E1 & I1 & 1 \\
  \hline
   E2 & I2 & 1 \\
  \hline
   E3 & I3 & 2 \\
  \hline
   E4 & I4 & 1 \\
  \hline
 \end{tabular} 
\\L'évenement E3 à 2 occurences, car il y en a une pour l'utilisateur U1 et une pour l'utilisateur U2.
Le tableau contenant le modèle proprement dit sera de la forme suivante :\\
 \begin{tabular}{|c|c|c|}
  \hline
   \textbf{Heures} & \textbf{U1} & \textbf{U2} \\
  \hline
  \hline
   H1 & E1 & \\
  \hline
   H2 & E1 & E2 \\
  \hline
   H3 & E1,E4 & E2 \\
  \hline
   H4 & E4 & E2 \\
  \hline
   H6 & E3 & E3 \\
  \hline
   H7 & E3 & E3 \\
  \hline
 \end{tabular} 
 \\\textbf{Fin exemple}\\
 Une fois le modèle constitué il est traité dans la fonction \fonction{dis\_planning\_(day ou week)}.
 Pour ce faire, on entrera dans une structure de controle qui bouclera sur les unité de temps. A chaque itération on vérifie pour 
 chaque utilisateur si il y a un évemenement à l'unité de temps en cours dans le tableau \variable{current\_events}.
 Si oui alors :
 \begin{itemize}
  \item{On test si les informations de cet évenement on déjà était affiché pour cet utilisateur. Si oui on continue l'iteration sur les unités de temps}
  \itemize{Si non, on insère dans la vue les informations propre à l'evenement détécté et dans \variable{event\_data} on diminue le nombre d'occurence de l'evenement de 1.}
  \item{On determine la taille de la case contenant les informations en comptant le nombre de boucle qui reponde à la condition : intersection des évenement à l'heure T et des évenements a l'heure T+1 n'est pas nulle. Cette condition permet en fait de determiné la plage horraire sur laquelle se deroule l'evenement et eventuellement les évenements qui sont en conflits avec celui ci.}
  \item{On reprend l'iteration sur les unités de temps}
 \end{itemize}
Enfin on affiche la vue.
 \\\textbf{Exemple:}\\
Reprenons l'exemple ci-dessus :
On boucle donc sur les unités de temps :


H1 : Un évenement pour l'utilisateur U1 dans le tableau.\\
Dans \variable{event\_data} le nombre d'occurence de E1 > 0.\\
On insère donc dans la vue les information I1 et on decrement le nombre d'occurence de E1.\\
On boucle sur la \variable{current\_events}:\\
\begin{itemize}
 \item{H2 : Dans \variable{event\_data} le nombre d'occurence de E1 = 0.Intersection de \variable{current\_events[H1][U1]} et \variable{current\_events[H2][U1]} = E1. On continue donc a boucler.}
 \item{H3 : Dans \variable{event\_data} le nombre d'occurence de E1=0 et E4 > 0.On insère donc dans la vue les information I4 et on decrement le nombre d'occurence de E4. Intersection de \variable{current\_events[H3][U1]} et \variable{current\_events[H4][U1]} = E4. On continue donc a boucler.}
 \item{H4 : Dans \variable{event\_data} le nombre d'occurence de E4=0.Intersection de \variable{current\_events[H4][U1]} et \variable{current\_events[H5][U1]} = NULL. On arrete donc de boucler. La taille de la case sera donc de 4.}
On reprend l'iteration sur les heures :\\
\end{itemize}
H2: Un évenement pour l'utilisateur U1 et U2 dans le tableau.\\
Dans \variable{event\_data} le nombre d'occurence de E1 = 0, donc on ne s'en occupe pas, par contre pour E2 il est supérieur à 0.\\
On insère donc dans la vue les information I2 et on decrement le nombre d'occurence de E2.\\
On boucle sur la \variable{current\_events}:\\
\begin{itemize}
 \item{H3 : Dans \variable{event\_data} le nombre d'occurence de E2 = 0.Intersection de \variable{current\_events[H3][U2]} et \variable{current\_events[H4][U2]} = E2. On continue donc a boucler.}
 \item{H4 : Dans \variable{event\_data} le nombre d'occurence de E2 = 0.Intersection de \variable{current\_events[H4][U2]} et \variable{current\_events[H5][U2]} = E2. On arrete donc de boucler. La taille de la case sera donc de 3.}
\end{itemize} 
H3 : Deux évenements pour l'utilisateur U1 et un pour l'utilisateur U2 dans le tableau.\\
Dans \variable{event\_data} le nombre d'occurence de E1, E4 et E2 sont égaux à 0, donc on ne s'en occupe pas.\\
H4 : Un évenement pour l'utilisateur U1 et U2 dans le tableau.\\
Dans \variable{event\_data} le nombre d'occurence de E4 et E2 sont égaux à 0, donc on ne s'en occupe pas.\\
H5 : Pas d'évenements.
H6 : Un évenement pour l'utilisateur U1 et U2 dans le tableau.\\
Dans \variable{event\_data} le nombre d'occurence de E3 > 0, on insère donc dans la vue les information I3 pour l'utilisateur U1 et on decrement le nombre d'occurence de E3. Le nombre d'occurence de E3 > 0 On insère donc dans la vue les information I3 pour l'utilisateur U2 et on decrement le nombre d'occurence de E3.\\
On boucle sur la \variable{current\_events}:\\
\begin{itemize}
 \item{H7 : Dans \variable{event\_data} le nombre d'occurence de E3 = 0.Intersection de \variable{current\_events[H6][U2]} et \variable{current\_events[H7][U2]} = E2. On continue donc a boucler.}
 \item{On arrive à la fin du tableau \variable{current\_events} on arrete donc la boucle.La taille de la case sera donc de 2}
\end{itemize} 
On à terminé la boucle sur les unités de temps. On affiche donc la vue qui ressemblera a cela :\\
\begin{center}
 \begin{tabular}{|c|c|c|}
  \hline
   \textbf{Heure} & \textbf{U1} & \textbf{U2} \\
  \hline
  \hline
  H1 & I1 & \\
  \cline{1-1}
  \cline{3-3}
  H2 & I4 & I2 \\
  \cline{1-1} 
  H3 &  &  \\
  \cline{1-1} 
  H4 &  &  \\
  \hline 
  H5 &  &  \\
  \hline
  H6 & I3 & I3 \\
  \cline{1-1} 
  H7 & I3 & I3 \\
  \hline
 \end{tabular}  
\end{center}

\textbf{Fin exemple}\\
En ce qui concerne les vues annuelles et mensuelles, la difference se situe au niveau de la constitution du tableau \variable{current\_events}. Ce tableau est indexé sur les jours et non sur les unités de temps ( la fonction utilisé pour ce faire est la fonction \fonction{store\_daily\_events}). Ceci est du au fait que la vue pour ces affichages là est faites par jour et non par unité de temps. A part cela le fonctionnement est strictement le même.

\subsubsection{Insertion}

