% Documentation technique d'OBM : Configuration specifique à un site
% ALIACOM Pierre Baudracco
% $Id$


\section{Configuration spécifique d'un site}

Depuis la version 0.8, OBM est pensé pour faciliter la personnalisation d'une mise en oeuvre en restant compatible avec le produit générique.

Pour ce faire les options de configurations et les données spécifiques d'un site sont situées dans un fichier et un répertoire dédiés.\\

\begin{tabular}{|p{7cm}|p{5cm}|}
\hline
Fichier de configuration spécifique & obminclude/obm\_conf.inc \\
\hline
Répertoire de configuration spécifique & obminclude/site \\
\hline
\end{tabular}


\subsection{Les options de paramétrage}

Ces paramètres sont définis en valeur par défaut dans le fichier global.inc mais peuvent être modifiées dans le fichier spécifique au site obm\_conf.inc :\\

\begin{tabular}{|p{7cm}|p{5cm}|}
\hline
Fichier de défintion des valeurs par défaut & obminclude/global.inc \\
\hline
Fichier de configuration spécifique & obminclude/obm\_conf.inc \\
\hline
\end{tabular}
\vspace{0.3cm}

Liste des paramètres définis :\\


\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{8cm}|}
\hline
\textbf{Option} & \textbf{Valeur défaut} & \textbf{Description} \\
\hline
\$cgp\_host & http://obm/ & Hôte utilisé dans les liens (ex dans les mails envoyés) \\ 
\hline
\$cmail\_incident & & Adresse e-mail de destination des messages automatiques du module Incident \\ 
\hline
\$cgp\_todo\_nb & 5 & Nombre de Todo affichés \\ 
\hline
\$cak\_prev & P & ACCESSKEY pour page précédente \\ 
\hline
\$cak\_next & N & ACCESSKEY pour page suivante \\ 
\hline
\$cak\_page\_prev & 4 & ACCESSKEY pour groupe de pages précédent \\ 
\hline
\$cak\_page\_prev & 6 & ACCESSKEY pour groupe de pages suivant \\ 
\hline
\$cak\_begin & B & ACCESSKEY pour début de résultat \\ 
\hline
\$cak\_prev & E & ACCESSKEY pour fin de résultat \\ 
\hline
\$cs\_lifetime & 720 & Duree de session. Temps d'inactivite avant deconnexion \\ 
\hline
\$cg\_adm & 1 & Groupe Administrateur utilisé par section Administration \\ 
\hline
\$cg\_com & 2 & Groupe Commercial utilisé par section Commercial \\ 
\hline
\$cg\_prod & 3 & Groupe Production utilisé par section Production \\ 
\hline
\$caf\_company\_name & false & Indicateur de formattage automatique du nom de société \\ 
\hline
\$caf\_town & false & Indicateur de formattage automatique du nom de ville \\ 
\hline
\$cgp\_sess\_db & false & Indication de stockage des sessions en base de données \\ 
\hline
\$cql\_max\_row & 50 000 & Maximum de lignes de résultat autorisé pour une requète manuelle utilisateur (module \List)\\ 
\hline
\$cql\_max\_cost & 100 000 & Coût maximum autorisé pour une requète manuelle utilisateur (module \List)\\ 
\hline
\$cgp\_sql\_star & true & Traite le caractère * comme un joker dans les recherches \\ 
\hline
\$ctu\_sql\_limit & false & Indique si les requètes envoyées à la base de données doivent gérer la clause limit afin de restreindre les résultats au niveau base de données à la place de l'affichage \\ 
\hline
\$cgp\_show & Voir \ref{cgp_show} et \ref{cgp_show_2} & Indicateurs d'affichage des sections et modules \\ 
\hline
\$cgp\_hide & Voir \ref{cgp_hide} & Indicateurs d'affichage des champs \\ 
\hline
\$auth\_kind\footnotemark[1] & 'standalone' & "standalone" pour gérer les
authentifications dans la base OBM, "CAS" pour passer par un serveur
CAS \\ 
\hline
\$cas\_server & aucune & nom ou IP du serveur CAS. Utilisé seulement
si le mode d'authentification est "CAS". \\ 
\hline
\$cas\_server\_port & aucune & port du service CAS sur le serveur. Utilisé seulement
si le mode d'authentification est "CAS". \\ 
\hline
\$cas\_server\_uri & aucune  &  URI du service CAS sur le
serveur. Utilisé seulement si le mode d'authentification est "CAS".\\  
\hline
\end{longtable}

\footnotetext[1]{L'installation de l'authentification CAS est
  détaillée dans la documentation Aliamin. En attendant l'unification
  entre ces deux documentations, merci de vous référer à cette dernière.}


\subsection{Le paramétrage des sections visibles et leur lien}
\label{cgp_show}

Le tableau \$cgp\_show[``section''] définit pour chaque section si celle-ci doit être affichée ou non et précise son lien (url) par défaut.
Par défaut toutes les sections sont affichées et pointent vers le premier module affiché.

\paragraph{La configuration des liens} des sections est disponible depuis OBM 0.8.1.\\

Pour ne pas afficher une section il faut insérer dans le fichier de configuration la ligne :

\begin{verbatim}  
$cgp_show[``section''][``com''] = false;
\end{verbatim}  
\vspace{0.3cm}

Pour modifier l'url par défaut d'une section il faut insérer dans le fichier de configuration la ligne (pour faire pointer la section Production vers le module Document) :

\begin{verbatim}  
$cgp_show[``section''][``prod''] = ``$path/document/document_index.php'';
\end{verbatim}  
\vspace{0.3cm}

Liste des sections disponibles :\\
\begin{itemize}
\item com
\item prod
\item compta
\item user
\item admin
\item aliamin
\end{itemize}


\subsection{Le paramétrage des modules visibles}
\label{cgp_show_2}

Le tableau \$cgp\_show[``module''] définit pour chaque module si celui-ci doit être affiché ou non.
Par défaut tous les modules sont affichés.

Pour ne pas afficher un module il faut insérer dans le fichier de configuration la ligne :

\begin{verbatim}  
$cgp_show[``module''][``deal''] = false;
\end{verbatim}  
\vspace{0.3cm}

Liste des modules disponibles :\\
\begin{itemize}
\item company
\item contact
\item deal
\item list
\item agenda
\item todo
\item publication
\item time
\item project
\item contract
\item incident
\item document
\item account
\item invoice
\item payment
\item settings
\item user
\item group
\end{itemize}


\subsection{Le paramétrage des champs visibles}
\label{cgp_hide}

Afin de permettre des utilisations d'\obm d'orientations diverses, certains modules peuvent être paramétrés afin de ne pas afficher et gérer tous les champs prévus.

A partir de la version 0.8 d'\obm, les modules \company, \contact et \deal ont des champs paramétrables.\\

Le tableau \$cgp\_hide[``entity''] définit pour les modules cibles les champs devant être cachés.
Par défaut tous les champs sont affichés et il faut donc préciser explicitement les champs non souhaités.

Pour ne pas afficher un champ il faut insérer dans le fichier de configuration la ligne :

\begin{verbatim}  
$cgp_hide[``company''][``company_number''] = true;
\end{verbatim}  

Lorsqu'un champ est caché, il n'est plus disponible dans les critères de recherche, dans les listes de résultats ni dans les fiches de détail.

Les noms donnés aux champs du tableau \$cgp\_hide doivent être identiques aux noms des champs retournés par la requête des listes de résultat, car la classe OBM\_DISPLAY utilise ces noms pour déterminer si les champs doivent être affichés ou non.
Si le champ n'est pas proposé dans un résultat de requête (catégories de société), il n'y a pas cette contrainte.


\subsubsection{Les champs paramétrables du module \company}

Liste des champs paramétrables (masquables) du module \company :

\begin{verbatim}
// Company module
$cgp_hide["company"]["company_number"] = true;         // numéro
$cgp_hide["company"]["company_vat"] = true;            // numéro intracommunautaire
$cgp_hide["company"]["companytype_label"] = true;      // type
$cgp_hide["company"]["companyactivity_label"] = true;  // secteur d'activité
$cgp_hide["company"]["companynafcode_code"] = true;    // code NAF
$cgp_hide["company"]["category"] = true;               // catégorie
$cgp_hide["company"]["company_address3"] = true;       // ligne adresse 3
$cgp_hide["company"]["company_expresspostal"] = true;  // Cedex
\end{verbatim}  


\subsubsection{Les champs paramétrables du module \contact}

Liste des champs paramétrables (masquables) du module \contact :

\begin{verbatim}
// Contact module
$cgp_hide["contact"]["contact_function"] = true;  // fonction
$cgp_hide["contact"]["contact_title"] = true;     // titre
$cgp_hide["contact"]["category1"] = true;         // catégorie 1
$cgp_hide["contact"]["category2"] = true;         // catégorie 2
$cgp_hide["contact"]["contact_service"] = true;   // ligne service
$cgp_hide["contact"]["contact_address3"] = [AUTO] // ligne adresse 3
$cgp_hide["contact"]["contact_expresspostal"] = [AUTO];  // Cedex
\end{verbatim}  


\subsubsection{Les champs paramétrables du module \deal}

Liste des champs paramétrables (masquables) du module \deal :

\begin{verbatim}
// Company module
$cgp_hide["deal"]["category1"] = true;                 // catégorie
\end{verbatim}  


\subsubsection{Les dépendances entre modules}

Certains champs apparaissent dans différent modules.
Par exemple le champ \variable{contact\_function} apparait dans les modules \contact et \List, et ce champ, défini dans le module \contact peut être masqué.
Pour les champs dépendants, \obm calcule donc automatiquement la visibilité en fonction des dépendances.
Liste des champs dépendants :\\

\begin{tabular}{|p{2.5cm}|p{3.5cm}|p{2.5cm}|p{3.5cm}|}
\hline
\textbf{Entité source} & \textbf{Champ source} & \textbf{Entité dépendante} & \textbf{Dépendance} \\
\hline
\multirow{3}{2cm}{company} & \multirow{3}{2cm}{company\_address3} & contact & contact\_address3 \\ 
\cline{3-4}
& & list\_contact & address3 \\ 
\cline{3-4}
& & list\_contact\_2 & address3 \\ 
\hline
\multirow{3}{2cm}{company} & \multirow{3}{2cm}{company\_expresspostal} & contact & contact\_expresspostal \\ 
\cline{3-4}
& & list\_contact & expresspostal \\ 
\cline{3-4}
& & list\_contact\_2 & expresspostal \\ 
\hline
\multirow{2}{2cm}{contact} & \multirow{2}{2cm}{contact\_function} & list\_contact & function\_label \\ 
\cline{3-4}
& & list\_contact\_2 & function\_label \\ 
\hline
\end{tabular}
