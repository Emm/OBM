% Documentation technique d'OBM : Gestion des droits et profils
% ALIACOM Pierre Baudracco
% $Id$


%%\clearpage
\subsection{Gestion des droits et profils}

La gestion des droits est le mécanisme qui permet le contrôle et l'autorisation des informations accessibles et des actions exécutées par un utilisateur.\\

L'implémentation de la gestion des droits a été effectuée avec les objectifs suivants :\\
\begin{itemize}
\item Système peu intrusif dans le code (Eliminer ou éviter au maximum les tests de droits d'accès dans le code des modules)
\item Niveau de granularité à l'action exécutée
\item Faciliter l'évolution (modification des droits, des profils,...)
\item Système léger et performant (si possible sans accès à la base de données)
\item Système sûr.
\end{itemize}
\vspace{0.3cm}

Les fonctionnalitées proposées en standard (sans code spécifique dans un module) :\\
\begin{itemize}
\item Définition des sections et modules accessibles par profil.
\item Autorisation d'exécution au niveau de l'action d'un module par profil
\item Tout accès ou action non défini est interdit
\item Possibilité de tests plus spécifiques dans un module (ex: champ affiché selon droit précis) par utilisation de l'API de droits dans le module.
\item API simple de tests de droits.
\end{itemize}


\subsubsection{Droits, sections, modules et actions}

\paragraph{Définition du droit d'accès à une section}

La définition du droit d'accès (visibilité) à une section est précisée dans la définition des sections dans \fichier{obminclude/global\_pref.inc}
Un droit d'accès unitaire est requis (l'utilisateur doit avoir le droit de lecture \variable{\$cright\_read} sur la section USER pour qu'elle s'affiche dans l'exemple suivant).\\

\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
if ($cgp_show["section"]["user"]) {
  $sections["user"] = array('Name' => $l_section_user,
                           'Url'  => $cgp_show["section"]["user"],
                           'Right'=> $cright_read);
}
\end{verbatim}
\end{minipage}
}


\paragraph{Définition du droit d'accès à un module}

La définition du droit d'accès à un module est précisée dans la définition des modules dans \fichier{obminclude/global\_pref.inc}
Un droit d'accès unitaire est requis (l'utilisateur doit avoir le droit de lecture \variable{\$cright\_read} sur le module \settings pour y accéder dans l'exemple suivant).\\

\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
  if ($cgp_show["module"]["settings"]) {
    $modules["settings"] = array(
                               'Name'=> $l_module_settings,
                               'Ico' => "$ico_setting",
		               'Url' => "$path/settings/settings_index.php",
			       'Right'=> $cright_read);
  }
\end{verbatim}
\end{minipage}
}

\subsubsection{Définition d'un profil}


\subsubsection{Spécifications de la notion de visibilité}

Une api très simple (1 fonction définie dans global.inc) est disponible :\\

\shadowbox{
\begin{minipage}{13cm}
\begin{verbatim}
is_entity_visible($entity, $obm_q, $uid='''')
\end{verbatim}
\end{minipage}
}
\vspace{0.4cm}


