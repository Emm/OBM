% Documentation technique d'OBM : module Project
% ALIACOM Bastien Continsouzas
% $Id


\clearpage
\section{Project}

Le module \project \obm.

\subsection{Organisation de la base de données}

Le \project utilise 4 tables :
\begin{itemize}
 \item Project
 \item ProjectTask
 \item ProjectUser
 \item ProjectStat
\end{itemize}

\subsection{Project}
Table principale des informations d'un projet.\\

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_timeupdate & timestamp 14 & Date de mise à jour & \\
\hline
\_timecreate & timestamp 14 & Date de création & \\
\hline
\_userupdate & int 8 & Id du modificateur & \\
\hline
\_usercreate & int 8 & Id du createur & \\
\hline
\_label & varchar 128 & Label du projet & \\
\hline
\_tasktype\_id & int 8 & Type de tâche du projet & \\
\hline
\_company\_id & int 8 & Société contractante & NULL (projets internes)\\
\hline
\_deal\_id & int 8 & Affaire d'origine & NULL (projets internes)\\
\hline
\_soldtime & int 8 & Durée (jours) vendue & \\
\hline
\_archive & int 2 & Indicateur d'archivage & (1 = 0ui)\\
\hline
\_comment & text (64k) & Commentaire &\\
\hline
\end{tabular}


\subsection{ProjectTask}
Table des informations des tâches des projets.\\

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_project\_id & int 8 & Projet de la tâche & \\
\hline
\_timeupdate & timestamp 14 & Date de mise à jour & \\
\hline
\_timecreate & timestamp 14 & Date de création & \\
\hline
\_userupdate & int 8 & Id du modificateur & \\
\hline
\_usercreate & int 8 & Id du createur & \\
\hline
\_label & varchar 128 & Label de la tâche & \\
\hline
\_parenttask\_id & int 8 & Tâche mère (ProjectTask) & 0 si racine \\
\hline
\_rank & int 8 & Ordre d'affichage de la tâche & \\
\hline
\end{tabular}


\subsection{ProjectUser}
Table d'affectation (avec informations associées) d'utilisateurs aux tâches d'un projet.

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_id & int 8 & Identifiant & Clé primaire \\
\hline
\_project\_id & int 8 & Projet & \\
\hline
\_user\_id & int 8 & Utilisateur & \\
\hline
\_projecttask\_id & int 8 & Tâche & \\
\hline
\_timeupdate & timestamp 14 & Date de mise à jour & \\
\hline
\_timecreate & timestamp 14 & Date de création & \\
\hline
\_userupdate & int 8 & Id du modificateur & \\
\hline
\_usercreate & int 8 & Id du createur & \\
\hline
\_projectedtime & int 8 & Durée prévue & \\
\hline
\_missingtime & int 8 & Durée restante estimée & Par Chef P \\
\hline
\_validity & timestamp 14 & Date d'estimation d'avancement & \\
\hline
\_soldprice & int 8 & Prix de vente de l'utilisateur & \\
\hline
\_manager & int 1 & Statut de l'utilisateur dans le projet & 1 = CP \\
\hline
\end{tabular}

\subsubsection{Remarques}

\paragraph{projectuser\_validity} : Date de la dernière modification de l'avancement qui permet de vérifier la crédibilité des informations disponibles sur l'avancement du projet (non implémenté pour l'instant).
\paragraph{projectuser\_soldprice} : Tarif journalier de cet utilisateur sur cette tâche. Permet une analyse des coûts plus détaillée pour le projet (non implémenté pour l'instant).
\paragraph{projectuser\_manager} : Indique si la personne est chef de projet. Influe sur les droits de modification.\\


ProjectUser est en fait la table de liaison entre Tâches et Membres d'un projet.
L'ajout d'un membre au projet insère un tuple dans cette table avec une tâche nulle. Ainsi, la \textbf{liste des membres d'un projet} est directement tirée de cette table.


\subsection{ProjectStat}
Table d'historique des informations relatives à l'avancement des projet.\\

\begin{tabular}{|p{3cm}|c|p{5.4cm}|p{2.6cm}|}
\hline
\textbf{Champs} & \textbf{Type} & \textbf{Description} & \textbf{Commentaire} \\
\hline
\_project\_id & int 8 & Projet & \\
\hline
\_usercreate & int 8 & Id du créateur & \\
\hline
\_date & timestamp 14 & Date d'estimation d'avancement & \\
\hline
\_useddays & int 8 & Durée passée (jours) sur le projet & \\
\hline
\_remainingdays & int 8 & Durée restante estimée & Par Chef P \\
\hline
\end{tabular}


\clearpage


\subsection{Actions, droits, et fonctions}
Dans cette section seront listées et décrites les actions du module, ainsi que les droits qui leurs sont appliqués et l'intitulé des fonctions executées. 

\subsubsection{Actions}

Voici la liste des action du module \project, ainsi qu'une description sommaire de chacune d'entre elles.\\

\begin{tabular}{|c|p{9cm}|}
 \hline
 \textbf{Intitulé} & \textbf{Description} \\
 \hline
 \hline
  <index> & (Défaut) formulaire de recherche de projets. \\ 
 \hline
  <search> & Résultat de recherche de projets. \\
 \hline
  <new> & Formulaire de création d'un projet. \\
 \hline
  <detailconsult> & Fiche détail d'un projet. \\
 \hline
  <detailupdate> & Formulaire de modification d'un projet. \\
 \hline
  <insert> & Insertion d'un projet. \\
 \hline
  <update> & Mise à jour du projet. \\
 \hline
  <task\_fill> & Affiche le formulaire permettant l'ajout de tâches au projet et la liste des tâches déjà existantes. \\
 \hline
  <member\_fill> & Affiche la liste des participants au projet et leurs statuts respectifs. \\
 \hline
  <membertime\_fill> & Affiche le formulaire permettant l'affectation des participants aux différentes tâches. \\
 \hline
  <validate> & Valide les modifications faites à l'écran de modification des affectations et affiche l'écran de consultation. \\
 \hline
  <advanceupdate> & Affiche le formulaire permettant de modifier les informations relatives au projet. \\
 \hline
  <a\_update> & Valide les modifications faites à l'écran de modification de l'avancement et affiche l'écran de consultation. \\
 \hline
  <ext\_get\_ids> & affiche une fenêtre permettant d'ajouter des participants au projet (géré par le module \user). \\
 \hline
  <task\_add> & Ajoute une tâche et affiche le formulaire permettant l'ajout de tâches au projet et la liste des tâches déjà existantes. \\
 \hline
  <task\_del> & Supprime une tâche et affiche le formulaire permettant l'ajout de tâches au projet et la liste des tâches déjà existantes. \\
 \hline
  <member\_add> & Ajoute un participant et affiche la liste des participants au projet et leurs statuts respectifs. \\
 \hline
  <member\_del> & Enlève in participant et affiche la liste des participants au projet et leurs statuts respectifs. \\
 \hline
  <member\_change> & Change le statut (chef de projet/simple participant) et affiche la liste des participants au projet et leurs statuts respectifs. \\
 \hline
  <display\_pref> & Affiche l'écran de modification des préférences d'affichage. \\
 \hline
  <dispref\_display> & Modifie l'affichage d'un élément et affiche l'écran de modification des préférences d'affichage. \\
 \hline
  <dispref\_level> & Modifie l'ordre d'affichage et affiche l'écran de modification des préférences d'affichage. \\
 \hline
\end{tabular}

\clearpage

\subsubsection{Droits}

Ci-dessous le tableau présentant les droits necessaires à l'execution de chaque action ainsi que l'intitulé de ce droit. \\
\begin{tabular}{|c|c|l|}
 \hline
 \textbf{Action} & \textbf{Code du droit} & \textbf{Intitulé du droit}\\
 \hline
 \hline
  <index> & project\_read & Droits d'Utilisateur en lecture. \\ 
 \hline
  <search> & project\_read & Droits d'Utilisateur en ecriture. \\ 
 \hline
  <new> & project\_write & Droits d'Utilisateur en lecture. \\ 
 \hline
  <init> & project\_write & Droits d'Utilisateur en lecture. \\
 \hline
  <task\_fill> & project\_write & Droits d'Utilisateur en lecture. \\
 \hline
  <member\_fill> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <membertime\_fill> & project\_write & Droits d'Utilisateur en ecriture. \\ 
 \hline
  <validate> & project\_write & Droits d'Utilisateur en ecriture. \\ 
 \hline
  <detailconsult> & project\_read & Droits d'Utilisateur en lecture. \\ 
 \hline
  <detailupdate> & project\_write & Droits d'Utilisateur en lecture. \\
 \hline
  <d\_update> & project\_write & Droits d'Administrateur en ecriture. \\
 \hline
  <advanceupdate> & project\_write & Droits d'Administrateur en ecriture. \\
 \hline
  <a\_update> &  project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <ext\_get\_ids> &  user\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <task\_add> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <task\_del> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <member\_add> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <member\_del> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <member\_change> & project\_write & Droits d'Utilisateur en ecriture. \\
 \hline
  <display> & project\_read & Droits d'Utilisateur en ecriture. \\
 \hline
  <dispref\_display> & project\_read & Droits d'Utilisateur en ecriture. \\
 \hline
  <dispref\_level> & project\_read & Droits d'Utilisateur en ecriture. \\
 \hline
\end{tabular}
Les 

\subsubsection{Fonctions}
 Ci-dessous le tableau présentant la ou les fonctions appelées pour chacune des actions. \\
\begin{tabular}{|c|c|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)}\\
 \hline
 \hline
  <index> & dis\_project\_search\_form() \\
 \hline
  <search> & dis\_project\_search\_form() \\
           & dis\_project\_search\_list() \\
 \hline
  <new> & run\_query\_projecttype() \\ 
        & html\_project\_form() \\
 \hline
  <init> & run\_query\_detail() \\ 
         & html\_project\_init\_form() \\
 \hline
  <task\_fill> & run\_query\_projectname() \\
 	       & run\_query\_tasks() \\
	       & html\_project\_taskadd\_form() \\
	       & html\_project\_tasklist() \\
 \hline
  <member\_fill> & run\_query\_projectname() \\
 	         & run\_query\_tasks() \\
	         & run\_query\_members() \\
	         & html\_project\_member\_form() \\
 \hline
  <membertime\_fill> & run\_query\_projectname() \\
 	             & run\_query\_tasks() \\
	             & run\_query\_members() \\
	             & run\_query\_membertime() \\
                     & html\_project\_membertime\_form() \\
 \hline
  <validate> & run\_query\_projectupdate() \\
             & run\_query\_detail() \\ 
 	     & run\_query\_tasks() \\
	     & run\_query\_members() \\
	     & run\_query\_membertime() \\
             & html\_project\_consult() \\
 \hline
 \end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline
  <detailconsult> & run\_query\_create() \\
                  & run\_query\_detail() \\ 
                  & html\_project\_consult() \\
                  & ou \\
                  & run\_query\_insert() \\
                  & run\_query\_detail() \\ 
                  & html\_project\_consult() \\
                  & ou \\
                  & run\_query\_detail() \\ 
 	          & run\_query\_tasks() \\
	          & run\_query\_members() \\
	          & run\_query\_membertime() \\
                  & html\_project\_consult() \\
 \hline
  <detailupdate> & run\_query\_detail() \\ 
                 & html\_project\_init\_form() \\
                 & ou \\
                 & run\_query\_projecttype() \\
                 & html\_project\_form() \\
 \hline
 <d\_update> & run\_query\_update() \\ 
             & run\_query\_detail() \\ 
 	     & run\_query\_tasks() \\
	     & run\_query\_members() \\
	     & run\_query\_membertime() \\
             & html\_project\_consult() \\
 \hline
  <advanceupdate> & run\_query\_projectname() \\
 	          & run\_query\_tasks() \\
	          & run\_query\_members() \\
	          & run\_query\_membertime() \\
                  & html\_project\_advance() \\
 \hline
 <a\_update> & run\_query\_advanceupdate() \\ 
             & run\_query\_statlog() \\ 
             & run\_query\_detail() \\ 
 	     & run\_query\_tasks() \\
	     & run\_query\_members() \\
	     & run\_query\_membertime() \\
             & html\_project\_consult() \\
 \hline
\end{tabular}

\begin{tabular}{|c|c|p{3cm}|}
 \hline
 \textbf{Action} & \textbf{Fonction(s)} \\
 \hline
 \hline
 <task\_add> & run\_query\_tasklist\_insert()\\ 
             & run\_projectname() \\
             & run\_query\_tasks() \\
	     & html\_project\_taskadd\_form() \\
	     & html\_project\_tasklist() \\
 \hline 
 <task\_del> & run\_query\_tasklist\_delete()\\ 
             & run\_projectname() \\
             & run\_query\_tasks() \\
	     & html\_project\_taskadd\_form() \\
	     & html\_project\_tasklist() \\
 \hline
 <member\_add> & run\_query\_projectname() \\
               & run\_query\_memberlist\_insert()\\ 
 	       & run\_query\_tasks() \\
	       & run\_query\_members() \\
	       & html\_project\_member\_form() \\
 \hline 
 <member\_del> & run\_query\_projectname() \\
               & run\_query\_memberlist\_delete()\\ 
 	       & run\_query\_tasks() \\
	       & run\_query\_members() \\
	       & html\_project\_member\_form() \\
 \hline 
 <member\_change> & run\_query\_projectname() \\
                  & run\_query\_memberstatus\_change()\\ 
 	          & run\_query\_tasks() \\
	          & run\_query\_members() \\
	          & html\_project\_member\_form() \\
 \hline
  <display> & run\_query\_display\_pref() \\
            & dis\_project\_display\_pref() \\
 \hline
  <dispref\_display> & run\_query\_display\_pref\_update() \\
                     & run\_query\_display\_pref() \\
                     & dis\_project\_display\_pref() \\
 \hline
  <dispref\_level> & run\_query\_display\_pref\_level\_update() \\
                   & run\_query\_display\_pref() \\
                   & dis\_project\_display\_pref() \\
 \hline
\end{tabular}

\subsection{Fonctionalité}
 Dans cette partie seront abordées les fonctionnalités du module \project. Ces fonctionnalités seront étudiés d'un point de vue technique et non utilisateur. Il va donc plus être sujet du fonctionnement que de l'utilité et de l'utilisation du module.

\subsubsection{Création du projet}

 Deux cas de figure sont possibles :
 \begin{description}
  \item{Projet relié à une affaire} : on modifie juste les informations relatives au projet dans la table Deal avec \fonction{run\_query\_create}
  \item{Projet interne} : on crée une nouvelle entrée dans la table Deal avec \fonction{run\_query\_insert}
 \end{description}

\subsubsection{Affichage du projet}

 Il se fait en deux temps
 \begin{itemize}
  \item{Récupération des informations dans la table} 
  \item{Affichage des différentes informations}
 \end{itemize}

 On récupère donc les données suivantes
 \begin{itemize}
  \item{\fonction{run\_query\_detail}} : informations qui caractérisent le projet (nom, société, type de projet, temps vendu/prévu)
  \item{\fonction{run\_query\_tasks}} : liste des sous-tâches du projet et les informations sur leur arborescence.
  \item{\fonction{run\_query\_members}} : liste des participants au projet et leur statut (chef de projet/participant)
  \item{\fonction{run\_query\_membertime}} : liste des affectations de personnes au sous-tâches du projet.
 \end{itemize}

 On affiche ces informations avec \fonction{html\_project\_consult}

\subsubsection{Modifications}

 Les informations susceptibles d'évoluer sont :
 \begin{itemize}
  \item{informations générales} : \fonction{run\_query\_update} modifie le nom, le temps vendu/prévu
  \item{liste des sous-tâches} : \fonction{run\_query\_tasklist\_insert} ajoute une sous-tâche et \fonction{run\_query\_tasklist\_delete} en enlève.
  \item{liste des participants} : \fonction{run\_query\_memberlist\_insert} ajoute un (ou plusieurs)  participant, \fonction{run\_query\_memberlist\_delete} en enlève et \fonction{run\_query\_memberstatus\_change} modifie le statut (chef de projet/participant).
  \item{liste des affectations} : \fonction{run\_query\_projectupdate} met à jour la liste des affectations.
  \item{liste des affectations} : \fonction{run\_query\_advanceupdate} met à jour l'état d'avancement des participants.
 \end{itemize}