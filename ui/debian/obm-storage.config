#!/bin/sh
#Produit toute les question lors de l'installation du paquet
#Les réponses peuvent être utilisé dans les scripts postinst
#, preinst, postrm, prerm


set -e
#set -x

# Source debconf library.
. /usr/share/debconf/confmodule

is_initial_configuration() { 
# Check if this is the initial configuration and not an upgrade of an 
# existing configuration 
# Usage: if is_initial_configuration "$@"; then ... fi from top level 

	# Plain installation 
	if [ "$1" = configure ] && [ -z "$2" ]; then 
	        return 0 
	fi 
	# Configuration via dpkg-reconfigure 
	if [ "$1" = reconfigure ] || [ "$DEBCONF_RECONFIGURE" ]; then 
	        return 0 
	fi 
	return 1 
}

#test si dbconfig-common est dejaconfigurer ou pas
if [ -f /usr/share/dbconfig-common/dpkg/config.mysql ]; then

db_get obm-conf/mysqlserver
OBM_HOST=$RET
db_get obm-conf/mysqldb
OBM_DB=$RET
db_get obm-conf/mysqluser
OBM_USER=$RET
db_get obm-conf/mysqlpasswd
OBM_PASSWD=$RET

#creation de la BD et User OBM 
	if [ -f /usr/share/dbconfig-common/dpkg/config.mysql ]; then
		. /usr/share/dbconfig-common/dpkg/config.mysql
		dbc_dbserver="$OBM_HOST"
		dbc_dbname="$OBM_DB"
		dbc_dbuser="$OBM_USER"
		dbc_dbpass="$OBM_PASSWD"
		dbc_go obm-storage $@
	fi

fi

exit 0

